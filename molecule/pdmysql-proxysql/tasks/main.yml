---
# tasks file for pdps-proxysql
- name: include tasks for test env setup
  include_tasks: ../../../tasks/test_prep.yml

- name: include tasks for enabling test repo
  include_tasks: ../../pdmysql_tasks/enable_testing_repo.yml
  when: lookup('env', 'REPO') == "testing" or lookup('env', 'REPO') == ""

- name: include tasks for enabling main repo
  include: ../../pdmysql_tasks/enable_main_repo.yml
  when: lookup('env', 'REPO') == "main"

- name: install proxysql new deb packages
  apt:
    name: "{{ packages }}"
    update_cache: yes
    state: latest
  vars:
    packages:
    - proxysql2
    - proxysql2-dbgsym
  when: ansible_os_family == "Debian"

- name: install proxysql new rpm packages
  yum:
    name: "{{ packages }}"
    state: latest
  vars:
    packages:
    - proxysql2
  when: ansible_os_family == "RedHat"

- name: check that proxysql version is correct
  command: /package-testing/version_check.sh proxysql2

- name: start proxysql service
  service: name=proxysql state=started

- name: stop proxysql service
  service: name=proxysql state=stopped

- name: start proxysql service
  service: name=proxysql state=started
